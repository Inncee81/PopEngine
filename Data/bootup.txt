# setup filter 01

# push some test input
#loadframe mancity01 time=1001 input01_undistorted.png
decode mancity01 /Volumes/Assets/LiveLikeVideo/ManCity_Camera1.mp4

# set meta data
#setuniform input01 MaskTopLeft=0.279179305x0.43300119
#setuniform input01 MaskTopRight=0.684121192x0.435912013
#setuniform input01 MaskBottomRight=0.930296421x0.617896974
#setuniform input01 MaskBottomLeft=0.0111219604x0.624482691

setuniform mancity01 MaskTopLeft=0.285x0.544
setuniform mancity01 MaskTopRight=0.768x0.552
setuniform mancity01 MaskBottomRight=0.982x0.840
setuniform mancity01 MaskBottomLeft=0.0x0.835

setuniform mancity01 RadialDistortionX=-.0900000036
setuniform mancity01 RadialDistortionY=.00999999978
setuniform mancity01 TangentialDistortionX=.0599999987
setuniform mancity01 TangentialDistortionY=0
setuniform mancity01 K5Distortion=0
setuniform mancity01 LensOffsetX=.0299999993
setuniform mancity01 LensOffsetY=.0500000007


# testing re distortion
#setuniform mancity01 RadialDistortionX=0
#setuniform mancity01 RadialDistortionY=0
#setuniform mancity01 TangentialDistortionX=0
#setuniform mancity01 TangentialDistortionY=0
#setuniform mancity01 K5Distortion=0
#setuniform mancity01 LensOffsetX=0
#setuniform mancity01 LensOffsetY=0
#setuniform mancity01 MaskTopLeft=0.385x0.544
#setuniform mancity01 MaskTopRight=0.668x0.62
#setuniform mancity01 MaskBottomRight=0.682x0.640
#setuniform mancity01 MaskBottomLeft=0.3x0.635


setuniform mancity01 RectMergeMax=50
setuniform mancity01 AtlasWidth=128 AtlasHeight=256

# add shader called crop to filter
addstage mancity01 undistort vert=ScreenQuad.vert frag=Undistort.frag
#addstage mancity01 debuguv vert=ScreenQuad.vert frag=DebugUv.frag
addstage mancity01 crop vert=ScreenQuad.vert frag=Crop.frag
addstage mancity01 hsl vert=ScreenQuad.vert frag=RgbToHsl.frag
addstage mancity01 grassfilter cl=GrassFilter.cl kernel=GrassFilter
addstage mancity01 grassfilled cl=AlphaFill.cl kernel=AlphaFill
addstage mancity01 DistortMask vert=ScreenQuad.vert frag=DistortMask.frag
addstage mancity01 rectfilter cl=CylinderFilter.cl kernel=FindLooseMinMaxs
addstage mancity01 DrawRects cl=GatherRects.cl kernel=DrawRects
addstage mancity01 GatherMinMaxs cl=GatherRects.cl kernel=GatherMinMaxs
addstage mancity01 DistortRects cl=GatherRects.cl kernel=DistortMinMaxs MinMaxDataStage=GatherMinMaxs
addstage mancity01 MakeRectAtlas Rects=DistortRects Image=Frame Mask=DistortMask
addstage mancity01 WriteRectAtlasStream AtlasStage=MakeRectAtlas Filename=mancity01.rectatlasstream


