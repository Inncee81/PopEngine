
# set meta data

setuniform LineDetector MaskTopLeft=0.285x0.544
setuniform LineDetector MaskTopRight=0.768x0.552
setuniform LineDetector MaskBottomRight=0.982x0.840
setuniform LineDetector MaskBottomLeft=0.0x0.835

setuniform LineDetector RadialDistortionX=-.0900000036
setuniform LineDetector RadialDistortionY=.00999999978
setuniform LineDetector TangentialDistortionX=.0599999987
setuniform LineDetector TangentialDistortionY=0
setuniform LineDetector K5Distortion=0
setuniform LineDetector LensOffsetX=.0299999993
setuniform LineDetector LensOffsetY=.0500000007

setuniform LineDetector RectMergeMax=50
setuniform LineDetector AtlasWidth=128 AtlasHeight=512


setuniform LineDetector TruthCorners=13x104,21x104,153x104,223x104,411x104,478x104,614x104,13x178,21x178,153x178,223x178,411x178,478x178,614x178,13x494,13x824,13x900,13x977,21x494,21x824,21x900,21x977,153x494,153x824,153x900,153x977,223x494,223x824,223x900,223x977,411x494,478x494,614x494,411x824,411x900,411x977,478x824,478x900,478x977,614x824,614x900,614x977,

# line detector
addstage LineDetector Hsl vert=ScreenQuad.vert frag=FrameToHsl.frag
addstage LineDetector WhiteFilterGroup cl=LineFilter.cl kernel=FilterWhite RenderAsRgb=0 DrawPalette=0
#addstage LineDetector WhiteFilterGroup_rgb cl=LineFilter.cl kernel=FilterWhite RenderAsRgb=1 DrawPalette=1
addstage LineDetector WhiteFilter cl=LineFilter.cl kernel=WhiteFilterEdges
#addstage LineDetector LineFilter cl=LineFilter.cl kernel=WhiteLineFilter
#addstage LineDetector HoughFilterPixels cl=LineFilter.cl kernel=HoughFilterPixels

#todo: make this loose, then do a refined filter on all matches
#addstage LineDetector HoughFilter StageType=GatherHoughLines cl=LineFilter.cl kernel=HoughFilter HoughAngleStep=5 HoughDistanceStep=0.25
addstage LineDetector HoughFilter StageType=GatherHoughLines cl=LineFilter.cl kernel=HoughFilter HoughAngleStep=0.5 HoughDistanceStep=1

addstage LineDetector ExtractHoughLines StageType=ExtractHoughLines cl=LineFilter.cl kernel=ExtractHoughLines HoughData=HoughFilter HoughScoreMin=0.6 HoughScoreMax=1

#addstage LineDetector DrawHoughLinesDynamic StageType=DrawHoughLinesDynamic cl=LineFilter.cl kernel=DrawHoughLinesDynamic HoughData=HoughFilter ClearFrag=Frame HoughScoreMin=100 HoughScoreMax=5000
addstage LineDetector DrawHoughLines StageType=DrawHoughLines cl=LineFilter.cl kernel=DrawHoughLines HoughLineData=ExtractHoughLines ClearFrag=Frame
#addstage LineDetector DrawHoughGraph cl=LineFilter.cl kernel=DrawHoughGraph HoughData=HoughFilter

addstage LineDetector ExtractHoughCorners StageType=ExtractHoughCorners cl=HoughCorners.cl kernel=ExtractHoughCorners HoughLineData=ExtractHoughLines MinScore=0.01
addstage LineDetector DrawHoughCorners StageType=DrawHoughCorners cl=HoughCorners.cl kernel=DrawHoughCorners HoughCornerData=ExtractHoughCorners ClearFrag=Frame Zoom=1.0
addstage LineDetector DrawHoughCornersZoom StageType=DrawHoughCorners cl=HoughCorners.cl kernel=DrawHoughCorners HoughCornerData=ExtractHoughCorners Zoom=0.5

addstage LineDetector HoughCornerHomographys StageType=GetHoughCornerHomographys cl=HoughCorners.cl kernel=HoughCornerHomography HoughCornerData=ExtractHoughCorners


#loadframe LineDetector time=1001 input01_undistorted.png
#decode LineDetector /Volumes/Assets/LiveLikeVideo/ManCity_Camera1_126.mp4
decode LineDetector /Volumes/Assets/5goals.mp4
#loadframe LineDetector FootballPitch.png time=1001




